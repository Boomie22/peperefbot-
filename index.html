<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Story Share</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        #shareBtn { background-color: #0088cc; color: white; border: none; padding: 15px; font-size: 18px; border-radius: 5px; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>üì¢ –ü–æ–¥–µ–ª–∏—Å—å –°—Ç–æ—Ä–∏—Å!</h1>
    <img id="storyImage" src="img.png" width="100%" alt="Story Image">
    <textarea id="storyCaption" style="width: 90%; height: 50px; margin: 10px;"></textarea>
    <button id="shareBtn">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const tg = window.Telegram?.WebApp;
            const refId = "ref_" + Math.random().toString(36).substring(7); // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ref ID
            const link = `https://peperefbot.com/?ref=${refId}`;
            const caption = `üî• PepeRefBot ‚Üí –ü–æ–ª—É—á–∞–π –±–æ–Ω—É—Å—ã! üëá\n${link}`;

            document.getElementById("storyCaption").value = caption;

            document.getElementById("shareBtn").addEventListener("click", function () {
                console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –°—Ç–æ—Ä–∏—Å —Å ID:", refId);
                const storyLink = `tg://msg?text=${encodeURIComponent(caption)}&url=${encodeURIComponent(link)}`;
                tg.openTelegramLink(storyLink);

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º ID –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                fetch("https://your-api.onrender.com/api/save_ref", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ ref_id: refId, username: tg?.initDataUnsafe?.user?.username })
                });
            });
        });
    </script>
</body>
</html>
